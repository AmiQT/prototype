---
const menuItems = [
    { id: 'overview', label: 'Overview', icon: 'fas fa-chart-pie', href: '/dashboard/v2' },
    { id: 'users', label: 'Users', icon: 'fas fa-user-graduate', href: '#' },
    { id: 'events', label: 'Events', icon: 'fas fa-calendar-star', href: '#' },
    { id: 'analytics', label: 'Analytics', icon: 'fas fa-brain', href: '#' },
    { id: 'settings', label: 'Settings', icon: 'fas fa-sliders-h', href: '#' },
];

interface Props {
    activeSection?: string;
}

const { activeSection = 'overview' } = Astro.props;
---

<!-- Mobile Toggle Button -->
<button id="mobile-menu-btn" class="lg:hidden fixed top-4 left-4 z-50 w-10 h-10 bg-white/80 backdrop-blur-md rounded-xl shadow-lg flex items-center justify-center text-slate-600 border border-white/50 hover:bg-white transition-all active:scale-95">
    <i class="fas fa-bars text-lg"></i>
</button>

<!-- Overlay (Mobile Only) -->
<div id="sidebar-overlay" class="fixed inset-0 bg-slate-900/20 backdrop-blur-sm z-40 hidden lg:hidden opacity-0 transition-opacity duration-300"></div>

<!-- Sidebar Container -->
<aside id="sidebar" class="transition-all duration-300 ease-out z-50
    /* Mobile Styles: Fixed full height drawer */
    fixed inset-y-0 left-0 w-[280px] -translate-x-full
    
    /* Desktop Styles: Sticky in-flow dock */
    lg:relative lg:translate-x-0 lg:block lg:w-[280px] lg:flex-shrink-0 lg:h-[calc(100vh-2rem)] lg:sticky lg:top-4 lg:ml-4 lg:my-4
">
    
    <!-- Glass Content Wrapper -->
    <!-- Mobile: Square corners right side, full height. Desktop: Rounded-3xl, full height -->
    <div class="w-full h-full flex flex-col p-6 relative overflow-hidden bg-white/80 backdrop-blur-xl border border-white/50 shadow-2xl
        lg:rounded-3xl lg:glass-panel lg:bg-white/70
    ">
        
        <!-- Decorative Glow (Desktop mostly) -->
        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 opacity-80"></div>

        <!-- Brand -->
        <div class="flex items-center gap-4 mb-10 px-2 pt-2 lg:pt-0">
            <div class="relative w-10 h-10 flex items-center justify-center bg-white rounded-xl shadow-md text-purple-600">
                <i class="fas fa-layer-group text-xl"></i>
                <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-400 border-2 border-white rounded-full"></div>
            </div>
            <div>
                <h1 class="font-bold text-lg tracking-tight text-slate-800">Talent<span class="text-purple-600">Pro</span></h1>
                <p class="text-[10px] font-semibold uppercase tracking-wider text-slate-400">Admin Console</p>
            </div>
            
            <!-- Mobile Close Button -->
            <button id="close-sidebar-btn" class="lg:hidden ml-auto text-slate-400 hover:text-slate-600 p-2">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 space-y-2 overflow-y-auto custom-scrollbar">
            <div class="text-xs font-bold text-slate-400 uppercase tracking-wider px-4 mb-4">Main Menu</div>
            
            {menuItems.map((item) => (
                <a href={item.href} class="group relative flex items-center gap-4 px-4 py-3.5 rounded-2xl transition-all duration-300 overflow-hidden hover:shadow-sm hover:bg-white/60">
                    {/* Active State Background */}
                    <div class={`absolute inset-0 bg-gradient-to-r from-blue-500 to-purple-600 opacity-0 transition-opacity duration-300 ${activeSection === item.id ? 'opacity-100' : 'group-hover:opacity-0'}`}></div>
                    
                    {/* Icon */}
                    <i class={`${item.icon} w-5 text-center relative z-10 transition-colors duration-300 ${activeSection === item.id ? 'text-white' : 'text-slate-400 group-hover:text-purple-600'}`}></i>
                    
                    {/* Label */}
                    <span class={`font-medium relative z-10 transition-colors duration-300 ${activeSection === item.id ? 'text-white' : 'text-slate-600 group-hover:text-slate-900'}`}>
                        {item.label}
                    </span>

                    {/* Active Indicator Dot */}
                    {activeSection === item.id && (
                        <div class="absolute right-4 w-1.5 h-1.5 rounded-full bg-white shadow-[0_0_10px_rgba(255,255,255,0.8)] animate-pulse"></div>
                    )}
                </a>
            ))}
        </nav>

        <!-- User Profile (Bottom) -->
        <div class="mt-auto pt-6 border-t border-slate-200/50">
            <div class="flex items-center gap-3 p-3 rounded-2xl hover:bg-white/50 transition-colors cursor-pointer group">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-slate-200 to-slate-300 border-2 border-white shadow-sm flex items-center justify-center text-slate-500 font-bold text-sm group-hover:scale-105 transition-transform">
                    AD
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-bold text-slate-700 truncate">Admin User</p>
                    <p class="text-xs text-slate-500 truncate">admin@uthm.edu.my</p>
                </div>
                <button class="text-slate-400 hover:text-red-500 transition-colors">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </div>
</aside>

<style>
    /* Hide scrollbar for nav but keep functionality */
    .custom-scrollbar::-webkit-scrollbar {
        width: 4px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(203, 213, 225, 0.5);
        border-radius: 2px;
    }
</style>

<script>
    // Mobile Menu Logic
    const mobileBtn = document.getElementById('mobile-menu-btn');
    const closeBtn = document.getElementById('close-sidebar-btn');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');

    function toggleMenu() {
        const isClosed = sidebar?.classList.contains('-translate-x-full');
        
        if (isClosed) {
            // Open
            sidebar?.classList.remove('-translate-x-full');
            overlay?.classList.remove('hidden');
            // Small delay to allow display:block to apply before opacity transition
            setTimeout(() => {
                overlay?.classList.remove('opacity-0');
            }, 10);
        } else {
            // Close
            sidebar?.classList.add('-translate-x-full');
            overlay?.classList.add('opacity-0');
            setTimeout(() => {
                overlay?.classList.add('hidden');
            }, 300);
        }
    }

    mobileBtn?.addEventListener('click', toggleMenu);
    closeBtn?.addEventListener('click', toggleMenu);
    overlay?.addEventListener('click', toggleMenu);
</script>